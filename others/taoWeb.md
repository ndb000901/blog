# 淘宝优惠券查询

## 项目需求

**接入淘宝联盟-阿里妈妈API，开发淘宝商品优惠券查询、分发Web站点。通过替商家推广商品，赚取佣金。将web站点与QQ机器人结合，通过社交软件推广**

## 开发环境

>1.MDB-Pro-4.12
>
>2.php-7.2
>
>3.nginx-1.14.0

## 站点

**域名被封，由于阿里妈妈身份令牌需要域名备案，不晓得令牌何时失效**

http://139.186.201.25/

**首页**

由于本项目当时结合QQ机器人使用，主要使用搜索页面，并没有开发首页。

**搜索结果**

![image](https://user-images.githubusercontent.com/48900845/120469981-99c1d700-c3d5-11eb-8338-c7bbb949a99c.png)

![image](https://user-images.githubusercontent.com/48900845/120470024-a7775c80-c3d5-11eb-883e-15fa264f28b8.png)

**商品详情**

![image](https://user-images.githubusercontent.com/48900845/120470130-c970df00-c3d5-11eb-98d5-ef5036a6e99e.png)

**QQ机器人**

**由于鹅厂严打，之前开发的QQ机器人由于服务商跑路，无法使用**


## 项目需要改进的部分

**1.不适合高并发场景**

**2.没有接入数据库将一些数据持久化(API调用次数每天10w+，站点流量较小，API调用次数冗余)**

**3.接入redis，加快站点访问速度**

**4.CDN加速**


# 项目部署

## 环境

>1.ubuntu18.04
>
>2.nginx
>
>3.php-fpm7.2


## 安装

```
sudo apt update

# 安装nginx

sudo apt install nginx

# 安装php-fpm
sudo apt-get install php7.2-fpm

#配置php-fpm

sudo vi /etc/php/7.2/fpm/php.ini

将;cgi.fix_pathinfo=1改成cgi.fix_pathinfo=0(还要去掉分号)


```

**配置nginx**

**sudo vim /etc/nginx/sites-available/default**

```
server {
listen 80 default_server;
listen [::]:80 default_server;

# SSL configuration
#
# listen 443 ssl default_server;
# listen [::]:443 ssl default_server;
#
# Note: You should disable gzip for SSL traffic.
# See: https://bugs.debian.org/773332
#
# Read up on ssl_ciphers to ensure a secure configuration.
# See: https://bugs.debian.org/765782
#
# Self signed certs generated by the ssl-cert package
# Don't use them in a production server!
#
# include snippets/snakeoil.conf;

root /var/www/html;

# Add index.php to the list if you are using PHP
index index.html index.htm index.nginx-debian.html;

server_name _;

location / {
	# First attempt to serve request as file, then
	# as directory, then fall back to displaying a 404.
	try_files $uri $uri/ =404;
}

# pass PHP scripts to FastCGI server
#
#location ~ \.php$ {
#include snippets/fastcgi-php.conf;
#
#	# With php-fpm (or other unix sockets):
	fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
#	# With php-cgi (or other tcp sockets):
#	fastcgi_pass 127.0.0.1:9000;
#}

# deny access to .htaccess files, if Apache's document root
# concurs with nginx's one
#
#location ~ /\.ht {
#	deny all;
#}
}
```

**修改**

```
location ~ \.php$ {
	include snippets/fastcgi-php.conf;
#
#	# With php-fpm (or other unix sockets):
	fastcgi_pass unix:/var/run/php/php7.2-fpm.sock;
#	# With php-cgi (or other tcp sockets):
#	fastcgi_pass 127.0.0.1:9000;
}
```

**安装依赖**

```
sudo apt-get install php7.2-xml
sudo apt-get install php-curl
```

**重启**

```
sudo service nginx restart
sudo service php7.2-fpm restart
```
